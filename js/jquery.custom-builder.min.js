/*!*********************************************************************
*
*  Custom Builder
*  Kevin Batdorf
*
*  http://kevinbatdorf.com
*
*  MIT or GPL license
*
************************************************************************/
if(typeof Object.create!=="function"){Object.create=function(b){function a(){}a.prototype=b;return new a()}}(function(d,c,a,e){var b={setup:function(g,h){var f=this;f.options=d.extend({},d.fn.customBuilder.options,g);f.elem=h;f.modules=[];f.deferredAuth=d.Deferred();if(f.options.authenticate){f.getAuthInfo()}else{f.deferredAuth.resolve()}f.deferredAuth.then(function(){if(f.options.headerFile){f.fetchFile(f.options.userName,f.options.repoName,f.options.headerFile,function(i){f.modules[0]=i})}f.buttonEvent()},function(){})},getAuthInfo:function(){var f=this;d.post((f.options.loginInfoFile+"?ajax"),function(g){f.authInfo=d.parseJSON(g);f.buildAuthString();f.deferredAuth.resolve()})},buildAuthString:function(){var f=this;f.authString="?client_id="+f.authInfo.client_id+"&client_secret="+f.authInfo.client_secret},buttonEvent:function(){var f=this;d(".compile").on("click",function(){f.checkedCached=d(".options input:checked").toArray();f.numOfCheckboxes=f.checkedCached.length;if(f.numOfCheckboxes===0){return false}f.updateProgressBar(1/(f.numOfCheckboxes+1)*100);d(this).html(f.options.buttonProcessingText).off();f.increment=0;f.processFiles()})},processFiles:function(){var f=this;f.checkedDeferred=d.Deferred();f.fetchFile(f.options.userName,f.options.repoName,d(f.checkedCached[f.increment]).attr("id"),function(g){f.modules[f.increment+1]=g;if(f.modules.length===f.numOfCheckboxes+1){f.finalizeFile()}else{f.checkedDeferred.resolve();f.increment=f.increment+1;f.updateProgressBar();f.processFiles()}})},updateProgressBar:function(i){var h=this,g=i||((h.increment+1)/(h.numOfCheckboxes+1))*100,f=((g*d(".progress-bar-outer").width())/100);d(".progress-bar").animate({width:f},200)},fetchFile:function(g,i,h,j){var f=this;f.deferredSha=d.Deferred();if(!f.options.sha){f.getSha(g,i,h)}else{f.sha=h;f.deferredSha.resolve()}f.deferredSha.then(function(){d.ajax({type:"GET",url:"https://api.github.com/repos/"+g+"/"+i+"/git/blobs/"+f.sha+f.authString,dataType:"jsonp",success:function(k){f.decodeData(k,j)}})},function(){})},getSha:function(g,i,h){var f=this;d.ajax({type:"GET",url:"https://api.github.com/repos/"+g+"/"+i+"/contents/"+h+f.authString,dataType:"jsonp",success:function(j){f.sha=j.data.sha;f.deferredSha.resolve();return j.data.sha}})},decodeData:function(g,h){if(g.data.content&&g.data.encoding==="base64"){var f=c.atob(g.data.content.replace(/\n/g,"")).split("\n");h(f.join("\n"))}},finalizeFile:function(){var f=this;if(f.options.footerFile){f.fetchFile(f.options.userName,f.options.repoName,f.options.footerFile,function(g){(f.modules).push(g);f.adjustSettings()})}else{f.adjustSettings()}},adjustSettings:function(){var g=this,f=(g.modules).join(""),i=d(".options input:checked");if(g.options.adjustSettings){console.log(f);i.each(function(k){var j=d(this).data("cbuilder");d.each(j,function(l,m){f=f.replace(l,m)})});console.log(f);h(f)}else{h(f)}function h(j){g.finalizeProgress();d(".cb-output").val(j)}},finalizeProgress:function(){var f=this;f.updateProgressBar(100);if(f.options.progressBarText!==null){d(".progress-bar").html(f.options.progressBarText)}f.finalizeButton()},finalizeButton:function(){var f=this;d(".compile").html(f.options.buttonFinishedText).wrap('<form class="cb-form" action="'+f.options.actionFile+'" method="post"></form>').after('<input type="hidden" name="cb-output" class="cb-output">')}};d.fn.customBuilder=function(f){return this.each(function(){var g=Object.create(b);g.setup(f,this);d.data(this,"customBuilder",g)})};d.fn.customBuilder.options={userName:"username",repoName:"repository",sha:false,headerFile:null,footerFile:null,buttonProcessingText:"Building...",buttonFinishedText:"Download Now",progressBarText:null,actionFile:"build.php",authenticate:false,loginInfoFile:"build.php",adjustSettings:true}})(jQuery,window,document);